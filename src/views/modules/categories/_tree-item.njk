<!-- Tree Item for Category Hierarchy -->
<div class="category-tree-item" data-category-id="{{ category._id }}" style="margin-left: {{ category.level * 20 }}px;">
  <div class="d-flex align-items-center justify-content-between border rounded p-3 mb-2 {{ 'bg-light' if not category.isActive }}">
    <div class="d-flex align-items-center">
      {% if category.level > 0 %}
        <div class="me-2 text-muted">
          {% for i in range(category.level) %}
            {% if loop.last %}
              └─
            {% else %}
              │&nbsp;&nbsp;
            {% endif %}
          {% endfor %}
        </div>
      {% endif %}
      
      {% if category.image %}
      <div class="avatar avatar-sm me-3">
        <img src="{{ category.image }}" alt="{{ category.name }}" class="rounded">
      </div>
      {% else %}
      <div class="avatar avatar-sm me-3">
        <span class="avatar-initial rounded bg-label-primary">{{ category.name.charAt(0).toUpperCase() }}</span>
      </div>
      {% endif %}
      
      <div>
        <h6 class="mb-1 d-flex align-items-center">
          {{ category.name }}
          {% if not category.isActive %}
            <span class="badge bg-label-secondary ms-2">Inactive</span>
          {% endif %}
        </h6>
        <small class="text-muted d-flex align-items-center gap-2">
          <span>{{ category.slug }}</span>
          <span class="badge bg-label-info">Level {{ category.level }}</span>
          {% if category.productsCount > 0 %}
            <span class="badge bg-label-warning">{{ category.productsCount }} Products</span>
          {% endif %}
        </small>
      </div>
    </div>
    
    <div class="d-flex align-items-center gap-2">
      {% if category.subcategoriesCount > 0 %}
        <button class="btn btn-sm btn-outline-secondary" onclick="toggleSubcategories('{{ category._id }}')" id="toggle-{{ category._id }}">
          <i class="bx bx-chevron-down"></i>
        </button>
      {% endif %}
      
      <div class="dropdown">
        <button type="button" class="btn btn-sm p-0 dropdown-toggle hide-arrow" data-bs-toggle="dropdown">
          <i class="bx bx-dots-vertical-rounded"></i>
        </button>
        <div class="dropdown-menu">
          <a class="dropdown-item" href="/categories/{{ category._id }}/edit">
            <i class="bx bx-edit-alt me-1"></i> Edit
          </a>
          <a class="dropdown-item" href="/categories/add?parent={{ category._id }}">
            <i class="bx bx-plus me-1"></i> Add Subcategory
          </a>
          <a class="dropdown-item" href="/categories/{{ category._id }}/products">
            <i class="bx bx-box me-1"></i> View Products ({{ category.productsCount or 0 }})
          </a>
          {% if category.isActive %}
          <a class="dropdown-item" href="javascript:void(0);" onclick="toggleStatus('{{ category._id }}', false)">
            <i class="bx bx-hide me-1"></i> Deactivate
          </a>
          {% else %}
          <a class="dropdown-item" href="javascript:void(0);" onclick="toggleStatus('{{ category._id }}', true)">
            <i class="bx bx-show me-1"></i> Activate
          </a>
          {% endif %}
          <div class="dropdown-divider"></div>
          <a class="dropdown-item text-danger" href="javascript:void(0);" onclick="deleteCategory('{{ category._id }}', '{{ category.name }}')">
            <i class="bx bx-trash me-1"></i> Delete
          </a>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Subcategories Container -->
  {% if category.subcategoriesCount > 0 %}
    <div id="subcategories-{{ category._id }}" class="subcategories-container d-none">
      <!-- Subcategories will be loaded dynamically -->
    </div>
  {% endif %}
</div>

{% if category.subcategories %}
  {% for subcategory in category.subcategories %}
    {% set category = subcategory %}
    {% include "modules/categories/_tree-item.njk" %}
  {% endfor %}
{% endif %}
